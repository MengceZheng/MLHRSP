# Improved Lattice-Based Attack on Mersenne Low Hamming Ratio Search Problem

## Introduction

This is a Python implementation of lattice-based attacks proposed in **Improved Lattice-Based Attack on Mersenne Low Hamming Ratio Search Problem**[^MLHRSP]. Some underlying functions are based on [Joachim Vandersmissen's crypto-attacks](https://github.com/jvdsn/crypto-attacks).

## Requirements

* [SageMath](https://www.sagemath.org/) with Python 3.9
* [PyCryptodome](https://pycryptodome.readthedocs.io/)

You can check your SageMath Python version using the following command:

```commandline
$ sage -python --version
Python 3.9.0
```

Note: If your SageMath Python version is older than 3.9.0, some features in given scripts might not work.

## Usage

To run this attack, you can simply execute the Python file **attack.py** with Sage using `sage -python attack.py` and then input several specific attack parameters:

```commandline
MLHRSP$ sage -python attack.py
PARI stack size set to 10000000000 bytes, maximum size set to 10000003072
Example Mersenne n: [521, 607, 1279, 2203, 2281, 3217, 4253, 4423, 9689, 9941, 11213, 19937, 21701, 23209, 44497, 86243, 110503, 132049, 216091, 756839]...
Input n (choosing from aboves): 521
Input w (satisfying 4*w^2 < n): 10
Input xi1 (0 to 1 & xi1+xi2=1): 0.5
Input xi2 (0 to 1 & xi1+xi2=1): 0.5
Input s (controlling lattices): 5
Input test times (for attacks): 3
Input type (basic or improved): basic
INFO:root:Test with n=521, w=10, xi1=0.5, xi2=0.5, and s=5 for 3 times:
INFO:root:Generating MLHRSP instance with 521-bit modulus p, 260-bit f, 260-bit g and Hamming weight 10...
INFO:root:Using basic solving strategy to find roots...
INFO:root:Trying s = 5...
INFO:root:Reducing a 21 x 21 lattice...
INFO:root:Succeeded!
INFO:root:Found f = 955284846635800160893481225277769036221884612714430516006372977888087691493376
INFO:root:Found g = 926336713898529563601989339072654690539654835593828345624461152184900424040449
INFO:root:Test 1 costs 0.445 seconds
INFO:root:Generating MLHRSP instance with 521-bit modulus p, 260-bit f, 260-bit g and Hamming weight 10...
INFO:root:Using basic solving strategy to find roots...
INFO:root:Trying s = 5...
INFO:root:Reducing a 21 x 21 lattice...
INFO:root:Succeeded!
INFO:root:Found f = 926336717356142723450637433735559365717969158898136753212391511889169103458304
INFO:root:Found g = 955284736208753766773872436256027916333454040341013680499948110177956375036417
INFO:root:Test 2 costs 0.102 seconds
INFO:root:Generating MLHRSP instance with 521-bit modulus p, 260-bit f, 260-bit g and Hamming weight 10...
INFO:root:Using basic solving strategy to find roots...
INFO:root:Trying s = 5...
INFO:root:Reducing a 21 x 21 lattice...
INFO:root:Succeeded!
INFO:root:Found f = 926337155640836322593640266977821399639396417261408975156614673777502894162048
INFO:root:Found g = 926393253004602472490583567719022352395609032763765833947798493173634675245073
INFO:root:Test 3 costs 0.095 seconds
INFO:root:The success rate for n=521, w=10, xi1=0.5, xi2=0.5 using s=5 and basic strategy is 100.0% and average time is 0.214 seconds
```

```commandline
MLHRSP$ sage -python attack.py
PARI stack size set to 10000000000 bytes, maximum size set to 10000003072
Example Mersenne n: [521, 607, 1279, 2203, 2281, 3217, 4253, 4423, 9689, 9941, 11213, 19937, 21701, 23209, 44497, 86243, 110503, 132049, 216091, 756839]...
Input n (choosing from aboves): 521
Input w (satisfying 4*w^2 < n): 10
Input xi1 (0 to 1 & xi1+xi2=1): 0.25
Input xi2 (0 to 1 & xi1+xi2=1): 0.75
Input s (controlling lattices): 7
Input test times (for attacks): 3
Input type (basic or improved): improved
INFO:root:Test with n=521, w=10, xi1=0.25, xi2=0.75, and s=7 for 3 times:
INFO:root:Generating MLHRSP instance with 521-bit modulus p, 130-bit f, 390-bit g and Hamming weight 10...
INFO:root:Using improved solving strategy to find roots...
INFO:root:Trying s = 7...
INFO:root:Reducing a 8 x 8 lattice...
INFO:root:Succeeded!
INFO:root:Found f = 680658195185335389527359254854679953408
INFO:root:Found g = 1261479854631441998532757130243076002991873504625509098824219953502086824102090783789586710033995275145608793952354305
INFO:root:Test 1 costs 0.360 seconds
INFO:root:Generating MLHRSP instance with 521-bit modulus p, 130-bit f, 390-bit g and Hamming weight 10...
INFO:root:Using improved solving strategy to find roots...
INFO:root:Trying s = 7...
INFO:root:Reducing a 8 x 8 lattice...
INFO:root:Succeeded!
INFO:root:Found f = 680564734002818808162774311099405762688
INFO:root:Found g = 1265789486645027963539756095495246425698787438107362553151779260885741887132492011185269717639245491124933408816366081
INFO:root:Test 2 costs 0.085 seconds
INFO:root:Generating MLHRSP instance with 521-bit modulus p, 130-bit f, 390-bit g and Hamming weight 10...
INFO:root:Using improved solving strategy to find roots...
INFO:root:Trying s = 7...
INFO:root:Reducing a 8 x 8 lattice...
INFO:root:Succeeded!
INFO:root:Found f = 680564733841881932801241762181570101252
INFO:root:Found g = 1260941155327975807744187151817803056246254910247949070511988544360889375340786650491488791506434475806802923252350977
INFO:root:Test 3 costs 0.086 seconds
INFO:root:The success rate for n=521, w=10, xi1=0.25, xi2=0.75 using s=7 and improved strategy is 100.0% and average time is 0.177 seconds
```

An alternative way to run the attack with the specific parameters n, h, xi1, xi2, s, and others requires passing them as command line arguments. For instance, to run the attack with n = 521, h = 10, xi1 = 0.5, xi2 = 0.5, and s = 5, please run `sage -python attack.py 521 10 0.5 0.5 5`:

```commandline
MLHRSP$ sage -python attack.py 521 10 0.5 0.5 5
PARI stack size set to 10000000000 bytes, maximum size set to 10000003072
INFO:root:Test with n=521, w=10, xi1=0.5, xi2=0.5, and s=5 for 5 times:
INFO:root:Generating MLHRSP instance with 521-bit modulus p, 260-bit f, 260-bit g and Hamming weight 10...
INFO:root:Using basic solving strategy to find roots...
INFO:root:Trying s = 5...
INFO:root:Reducing a 21 x 21 lattice...
INFO:root:Succeeded!
INFO:root:Found f = 926336713898555891461485019377869755518840304859631068724163735993839844851776
INFO:root:Found g = 926336717362882710924032666681403179661123895065547822389228279139135993675777
INFO:root:Test 1 costs 0.372 seconds
INFO:root:Generating MLHRSP instance with 521-bit modulus p, 260-bit f, 260-bit g and Hamming weight 10...
INFO:root:Using basic solving strategy to find roots...
INFO:root:Trying s = 5...
INFO:root:Reducing a 21 x 21 lattice...
INFO:root:Succeeded!
INFO:root:Found f = 955284736207858612244460626508747454943359529021183035760620684095388295659528
INFO:root:Found g = 926336741505725575134160156156006889889409342796874035678641361993201860214801
INFO:root:Test 2 costs 0.095 seconds
INFO:root:Generating MLHRSP instance with 521-bit modulus p, 260-bit f, 260-bit g and Hamming weight 10...
INFO:root:Using basic solving strategy to find roots...
INFO:root:Trying s = 5...
INFO:root:Reducing a 21 x 21 lattice...
INFO:root:Succeeded!
INFO:root:Found f = 926336714006369350069736902683271979775242762581047929892024541758145624539136
INFO:root:Found g = 926336713898950812555346318513073815727712405282434675804626905254947819880449
INFO:root:Test 3 costs 0.096 seconds
INFO:root:Generating MLHRSP instance with 521-bit modulus p, 260-bit f, 260-bit g and Hamming weight 10...
INFO:root:Using basic solving strategy to find roots...
INFO:root:Trying s = 5...
INFO:root:Reducing a 21 x 21 lattice...
INFO:root:Succeeded!
INFO:root:Found f = 926364987124858750937312044282126788903388229584982204707475395736364010963200
INFO:root:Found g = 926336934754412660688178353415537525881938620190655954865056170664593201300993
INFO:root:Test 4 costs 0.098 seconds
INFO:root:Generating MLHRSP instance with 521-bit modulus p, 260-bit f, 260-bit g and Hamming weight 10...
INFO:root:Using basic solving strategy to find roots...
INFO:root:Trying s = 5...
INFO:root:Reducing a 21 x 21 lattice...
INFO:root:Succeeded!
INFO:root:Found f = 926336713898635698432515147246285587111418524384503655824563700086436054171648
INFO:root:Found g = 926336713898542727425026545498994505554084708947590674336501936750105024528385
INFO:root:Test 5 costs 0.096 seconds
INFO:root:The success rate for n=521, w=10, xi1=0.5, xi2=0.5 using s=5 and basic strategy is 100.0% and average time is 0.151 seconds
```

Additionally, to run the attack with n = 521, h = 10, xi1 = 0.75, xi2 = 0.25, and s = 5 for 3 times using improved strategy, please run `sage -python attack.py 521 10 0.75 0.25 5 3 improved`:

```commandline
MLHRSP$ sage -python attack.py 521 10 0.75 0.25 5 3 improved
PARI stack size set to 10000000000 bytes, maximum size set to 10000003072
INFO:root:Test with n=521, w=10, xi1=0.75, xi2=0.25, and s=5 for 5 times:
INFO:root:Generating MLHRSP instance with 521-bit modulus p, 390-bit f, 130-bit g and Hamming weight 10...
INFO:root:Using improved solving strategy to find roots...
INFO:root:Trying s = 5...
INFO:root:Reducing a 6 x 6 lattice...
INFO:root:Succeeded!
INFO:root:Found f = 1260888247360670938845183001856209249980821508358413302326792398055983782616872581331946499942307124505861883437252608
INFO:root:Found g = 680564774411648196618686487514971635843
INFO:root:Test 1 costs 0.291 seconds
INFO:root:Generating MLHRSP instance with 521-bit modulus p, 390-bit f, 130-bit g and Hamming weight 10...
INFO:root:Using improved solving strategy to find roots...
INFO:root:Trying s = 5...
INFO:root:Reducing a 6 x 6 lattice...
INFO:root:Succeeded!
INFO:root:Found f = 1260864198284766678464972610817754958399014460627272501704634489390579977021451468010644347102127812939633110850469888
INFO:root:Found g = 680567329995257954578445535330814656513
INFO:root:Test 2 costs 0.019 seconds
INFO:root:Generating MLHRSP instance with 521-bit modulus p, 390-bit f, 130-bit g and Hamming weight 10...
INFO:root:Using improved solving strategy to find roots...
INFO:root:Trying s = 5...
INFO:root:Reducing a 6 x 6 lattice...
INFO:root:Succeeded!
INFO:root:Found f = 1261018262678053315750684631395840417258976012082261845072346006697668451171065788377378387538633295746511113552920576
INFO:root:Found g = 685923508721842862578765952005712121857
INFO:root:Test 3 costs 0.020 seconds
INFO:root:Generating MLHRSP instance with 521-bit modulus p, 390-bit f, 130-bit g and Hamming weight 10...
INFO:root:Using improved solving strategy to find roots...
INFO:root:Trying s = 5...
INFO:root:Reducing a 6 x 6 lattice...
INFO:root:Succeeded!
INFO:root:Found f = 1260864273443719730095567754447001791259591750028727270913903688889582905386475014666816072003910139341660167352614912
INFO:root:Found g = 701832381774438017639071089775752511553
INFO:root:Test 4 costs 0.019 seconds
INFO:root:Generating MLHRSP instance with 521-bit modulus p, 390-bit f, 130-bit g and Hamming weight 10...
INFO:root:Using improved solving strategy to find roots...
INFO:root:Trying s = 5...
INFO:root:Reducing a 6 x 6 lattice...
INFO:root:Succeeded!
INFO:root:Found f = 1260864217072963996985731093356361326159642897366524236755507255275976752549303937028958127210338417965017388663439360
INFO:root:Found g = 680564774406715477080385615357129285633
INFO:root:Test 5 costs 0.019 seconds
INFO:root:The success rate for n=521, w=10, xi1=0.75, xi2=0.25 using s=5 and improved strategy is 100.0% and average time is 0.074 seconds
```

[^MLHRSP]: Zheng M., Yan W., "Improved Lattice-Based Attack on Mersenne Low Hamming Ratio Search Problem"
